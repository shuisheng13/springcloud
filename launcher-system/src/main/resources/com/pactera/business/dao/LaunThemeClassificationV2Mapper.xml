<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pactera.business.dao.LaunThemeClassificationV2Mapper">

    <resultMap id="BaseResultMap" type="com.pactera.vo.LauncThemeClassVo">
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="create_date" jdbcType="TIMESTAMP" property="createDate" />
        <result column="update_date" jdbcType="TIMESTAMP" property="updateDate" />
        <result column="classification_name" jdbcType="VARCHAR" property="classificationName" />
        <result column="sort" jdbcType="INTEGER" property="sort" />
        <result column="quantity" jdbcType="INTEGER" property="quantity" />
        <result column="shelf_count" jdbcType="INTEGER" property="shelfCount" />
        <result column="cover_image" jdbcType="VARCHAR" property="coverImage" />
        <result column="creator" jdbcType="VARCHAR" property="creator" />
        <result column="shelf_status" jdbcType="VARCHAR" property="shelfStatus" />
        <result column="tenant_id" jdbcType="VARCHAR" property="tenantId" />
        <result column="disable" jdbcType="INTEGER" property="disable" />
    </resultMap>
    <sql id="Base_Column_List">
        id, classification_name, sort, cover_image, cover_image, shelf_status, disable, create_date, update_date, creator, tenant_id
    </sql>
    <update id="updateByThemClassId" parameterType="com.pactera.vo.LauncThemeClassVo">
        UPDATE
          laun_theme_classification
        <set>
            <if test="classificationName!=null">
                classification_name = #{classificationName},
            </if>
            <if test="coverImage!=null">
                cover_image = #{coverImage},
            </if>
            <if test="updateDate!=null">
                update_date = #{updateDate},
            </if>
            <if test="shelfStatus!=null">
                shelf_status = #{shelfStatus},
            </if>
            <if test="quantity>-1">
                quantity = #{quantity},
            </if>
            <if test="shelfCount>-1">
                shelf_count = #{shelfCount},
            </if>
        </set>
        WHERE
         id = #{id}
        <if test="tenantId!=null">
            AND tenant_id=#{tenantId}
        </if>
    </update>

    <update id="deleteByThemClassId" parameterType="String">
        UPDATE
          laun_theme_classification
        SET
          disable=0,update_date = NOW()
        WHERE
          id = #{0}

    </update>

    <select id="selectLauncThemeClassVo" resultMap="BaseResultMap" parameterType="com.pactera.vo.LauncThemeClassVo">
        SELECT
          <include refid="Base_Column_List"/>
        FROM
          laun_theme_classification
          <where>
              <if test="id!=null">
                  AND id = #{id}
              </if>
              <if test="classificationName!=null">
                  AND classification_name regexp(#{classificationName})
              </if>
              <if test="sort>0">
                  AND sort = #{sort}
              </if>
              <if test="quantity>0">
                  AND quantity = #{quantity}
              </if>
              <if test="shelfCount>0">
                  AND shelfCount = #{shelfCount}
              </if>
              <if test="coverImage!=null">
                  AND cover_image = #{coverImage}
              </if>
              <if test="creator!=null">
                  AND creator = #{creator}
              </if>
              <if test="shelfStatus!=null">
                  AND shelf_status = #{shelfStatus}
              </if>
              <if test="tenantId!=null">
                  AND tenant_id = #{tenantId}
              </if>
              <if test="disable!=null">
                  AND disable = #{disable}
              </if>
              <if test="updateDate!=null">
                  AND update_date = #{updateDate}
              </if>
              <if test="createDate!=null">
                  AND create_date = #{createDate}
              </if>
              ORDER BY create_date desc
          </where>


    </select>

    <update id="orderThemeClass" parameterType="java.util.List">
        UPDATE
          laun_theme_classification
        SET
          sort =
             <foreach collection="list" item="item" index="index" separator=" " open="case id" close="end,">
                when #{item.id} then #{item.sort}
             </foreach>
          update_date =
             <foreach collection="list" item="item" index="index" separator=" " open="case id" close="end">
                when #{item.id} then NOW()
             </foreach>
        WHERE
          id IN
          <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
              #{item.id,jdbcType=VARCHAR}
          </foreach>
    </update>

    <update id="updateThemTypeOrder">
        UPDATE
           laun_theme_classification
        SET
           sort = #{0}
        WHERE
           id = #{1}
     </update>


    <select id="seQuantityTheme" resultType="java.util.Map" parameterType="java.util.List">
         SELECT
           count(*) as quantity,
           type_id
         FROM
           laun_theme_administration
         WHERE
           type_id IN
           <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
               #{item,jdbcType=VARCHAR}
           </foreach>
         GROUP BY type_id;
    </select>

    <select id="seQuantityThemeUp" resultType="java.util.Map" parameterType="java.util.List">
        SELECT
        count(*) as shelfCount,
        type_id
        FROM
        laun_theme_administration
        WHERE
        type_id IN
        <foreach collection="list" index="index" item="item" separator="," open="(" close=")">
            #{item,jdbcType=VARCHAR}
        </foreach>
        AND status = 2
        GROUP BY type_id;
    </select>

</mapper>